<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Woning Analyse ‚Äì Bergweg ‚Ä¢ Marktwaardemeter</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body { background: #f3f4f6; }
    .input-label { font-size: 12px; font-weight: 600; color: #555; }
  </style>
</head>

<body class="bg-gray-100">
  <div id="app" class="w-full max-w-6xl mx-auto p-6">

    <!-- TITEL -->
    <div class="bg-white p-6 shadow rounded mb-6">
      <h1 class="text-3xl font-bold">üè† Woningmarkt Analyse ‚Äì Bergweg Rotterdam</h1>
      <p class="text-gray-600 mt-1">
        Realtime analyse van <strong>vraagprijzen, m¬≤-prijzen, woningtypes en marktvergelijkingen</strong>.
      </p>
    </div>

    <!-- KPI CARDS -->
    <div id="kpis" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"></div>

    <!-- Woning invoeren -->
    <div class="bg-white p-6 shadow rounded mb-6">
      <h2 class="text-xl font-semibold mb-4">üîç Vergelijk jouw woning</h2>

      <!-- BASISGEGEVENS -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">

        <div>
          <label class="input-label">Woonoppervlakte (m¬≤)</label>
          <input id="input-size" type="number" class="w-full p-2 border rounded" placeholder="Bijv. 85">
        </div>

        <div>
          <label class="input-label">Aantal kamers</label>
          <input id="input-rooms" type="number" class="w-full p-2 border rounded" placeholder="Bijv. 3">
        </div>

        <div>
          <label class="input-label">Energielabel</label>
          <select id="input-label" class="w-full p-2 border rounded">
            <option value="A+++">A+++</option>
            <option value="A++">A++</option>
            <option value="A+">A+</option>
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C" selected>C</option>
            <option value="D">D</option>
            <option value="E">E</option>
            <option value="F">F</option>
            <option value="?">Onbekend</option>
          </select>
        </div>

        <div>
          <label class="input-label">(Optioneel) Verwachte vraagprijs</label>
          <input id="input-price" type="number" class="w-full p-2 border rounded" placeholder="Bijv. 395000">
        </div>

      </div>

      <!-- GEAVANCEERDE FACTOREN ‚Äì COLLAPSIBLE -->
      <div class="mt-6 border-t pt-4">

        <button id="toggle-adv"
          class="w-full flex items-center justify-between text-left font-semibold text-gray-700 mb-3">
          <span>‚öôÔ∏è Geavanceerde woningfactoren</span>
          <span id="adv-icon">‚ñº</span>
        </button>

        <div id="adv-fields" class="grid grid-cols-1 md:grid-cols-3 gap-4 hidden">

          <!-- Bouwjaar -->
          <div>
            <label class="input-label">Bouwjaar</label>
            <select id="input-year" class="w-full p-2 border rounded">
              <option value="">Onbekend</option>
              <option value="1920">Voor 1930</option>
              <option value="1950">1930‚Äì1970</option>
              <option value="1980">1970‚Äì1990</option>
              <option value="1995">1990‚Äì2000</option>
              <option value="2005">2000‚Äì2010</option>
              <option value="2015">2010‚Äì2020</option>
              <option value="2023">> 2020</option>
            </select>
          </div>

          <!-- Onderhoudsstaat -->
          <div>
            <label class="input-label">Onderhoud / Afwerking</label>
            <select id="input-condition" class="w-full p-2 border rounded">
              <option value="normaal" selected>Normaal</option>
              <option value="slecht">Slecht</option>
              <option value="matig">Matig</option>
              <option value="goed">Goed</option>
              <option value="luxe">Luxe</option>
              <option value="zeer_luxe">Zeer luxe</option>
            </select>
          </div>

          <!-- Buitenruimte -->
          <div>
            <label class="input-label">Buitenruimte</label>
            <select id="input-outdoor" class="w-full p-2 border rounded">
              <option value="geen" selected>Geen</option>
              <option value="balkon">Balkon</option>
              <option value="dakterras">Dakterras</option>
              <option value="tuin_klein">Tuin (klein)</option>
              <option value="tuin_groot">Tuin (groot)</option>
            </select>
          </div>

          <!-- Erfpacht -->
          <div>
            <label class="input-label">Grondsituatie</label>
            <select id="input-lease" class="w-full p-2 border rounded">
              <option value="eigen" selected>Eigen grond</option>
              <option value="erfpacht_canon">Erfpacht (canon)</option>
              <option value="erfpacht_afgekocht">Erfpacht afgekocht</option>
            </select>
          </div>

          <!-- Servicekosten -->
          <div>
            <label class="input-label">Servicekosten p/m</label>
            <input id="input-service" type="number"
                   placeholder="Bijv. 150"
                   class="w-full p-2 border rounded">
          </div>

          <!-- VvE kwaliteit -->
          <div>
            <label class="input-label">VvE kwaliteit</label>
            <select id="input-vve" class="w-full p-2 border rounded">
              <option value="">Onbekend</option>
              <option value="slecht">Slecht</option>
              <option value="matig">Matig</option>
              <option value="redelijk">Redelijk</option>
              <option value="goed" selected>Goed</option>
              <option value="uitstekend">Uitstekend</option>
            </select>
          </div>

        </div>
      </div>

      <button id="btn-calc"
        class="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded text-lg font-semibold">
        Analyseer woning
      </button>

      <div id="user-output" class="mt-4 text-gray-800 text-sm"></div>
    </div>

    <!-- TABS -->
    <div class="bg-white shadow rounded">      
      <div class="bg-white shadow rounded">
        <div class="flex border-b flex-wrap">
      
          <button data-tab="overview" class="tab-btn px-6 py-3 border-b-2 border-blue-600 text-blue-600">
            Overzicht
          </button>
      
          <button data-tab="prices" class="tab-btn px-6 py-3 text-gray-600">
            Prijzen
          </button>
      
          <button data-tab="details" class="tab-btn px-6 py-3 text-gray-600">
            Details
          </button>
      
          <button data-tab="heatmap" class="tab-btn px-6 py-3 text-gray-600">
            Heatmap
          </button>
      
          <button data-tab="labels" class="tab-btn px-6 py-3 text-gray-600">
            Energielabels
          </button>
      
          <button data-tab="trend" class="tab-btn px-6 py-3 text-gray-600">
            Trend
          </button>
      
        </div>
      
        <!-- TAB CONTENT -->
        <div class="p-6">
      
          <!-- OVERZICHT -->
          <div id="tab-overview">
            <h2 class="text-lg font-semibold mb-4">Verdeling prijs per m¬≤</h2>
            <canvas id="chart-m2ranges" height="120"></canvas>
          </div>
      
          <!-- PRIJZEN -->
          <div id="tab-prices" class="hidden">
            <h2 class="text-lg font-semibold mb-4">Prijs vs. woonoppervlakte</h2>
            <canvas id="chart-scatter" height="140"></canvas>
          </div>
      
          <!-- DETAILS -->
          <div id="tab-details" class="hidden">
            <h2 class="text-lg font-semibold mb-4">Detailoverzicht</h2>
            <div class="overflow-x-auto">
              <table class="min-w-full bg-white rounded shadow">
                <thead class="bg-gray-100">
                  <tr>
                    <th class="px-4 py-2 text-left">Adres</th>
                    <th class="px-4 py-2 text-left">Prijs</th>
                    <th class="px-4 py-2 text-left">m¬≤</th>
                    <th class="px-4 py-2 text-left">‚Ç¨/m¬≤</th>
                    <th class="px-4 py-2 text-left">Status</th>
                  </tr>
                </thead>
                <tbody id="table-body"></tbody>
              </table>
            </div>
          </div>
      
          <!-- HEATMAP -->
          <div id="tab-heatmap" class="hidden">
            <h2 class="text-lg font-semibold mb-4">Heatmap: Prijs per m¬≤ per aantal kamers</h2>
            <canvas id="chart-heatmap" height="200"></canvas>
          </div>
      
          <!-- LABELS -->
          <div id="tab-labels" class="hidden">
            <h2 class="text-lg font-semibold mb-4">Gemiddelde prijs per m¬≤ per energielabel</h2>
            <canvas id="chart-labels" height="120"></canvas>
          </div>
      
          <!-- TREND -->
          <div id="tab-trend" class="hidden">
            <h2 class="text-lg font-semibold mb-4">Vraagprijs Trend (gesimuleerd)</h2>
            <canvas id="chart-trend" height="120"></canvas>
          </div>
      
        </div>
      </div>
      
      <!-- INSIGHTS -->
      <div class="bg-white rounded shadow mt-6 p-6">
        <h3 class="text-lg font-semibold mb-4">üìä Belangrijkste inzichten</h3>
        <ul id="insights" class="space-y-2 text-gray-700 text-sm"></ul>
      </div>
      
      <!-- AI WAARDERING -->
      <div class="bg-white rounded shadow mt-6 p-6">
        <h3 class="text-lg font-semibold mb-4">ü§ñ Marktwaardeschatting</h3>
        <p id="ai-valuation" class="text-gray-800 text-sm"></p>
      </div>
      

<script>
    /* ---------------------------------------------
       1. Data
    --------------------------------------------- */
    const properties = [
{ address: "Bergweg 365-A02", price: 419000, size: 93, rooms: 2, label: "B", status: "Verkocht" },
{ address: "Bergweg 143-A", price: 499500, size: 111, rooms: 2, label: "B", status: "Verkocht" },
{ address: "Bergweg 49-D", price: 450000, size: 135, rooms: 3, label: "B", status: "Verkocht" },
{ address: "Bergweg 104-H", price: 360000, size: 50, rooms: 1, label: "A+++", status: "Verkocht" },
{ address: "Bergweg 123-A", price: 650000, size: 146, rooms: 4, label: "B", status: "Verkocht" },
{ address: "Bergweg 262-A", price: 450000, size: 133, rooms: 6, label: "A", status: "Verkocht" },
{ address: "Bergweg 55-D", price: 419000, size: 108, rooms: 3, label: "D", status: "Verkocht" },
{ address: "Bergweg 252", price: 395000, size: 101, rooms: 3, label: "D", status: "Verkocht" },
{ address: "Bergweg 258-B", price: 300000, size: 95, rooms: 3, label: "F", status: "Verkocht" },
{ address: "Bergweg 167-B", price: 675000, size: 154, rooms: 3, label: "D", status: "Verkocht" },
{ address: "Bergweg 114-F", price: 535000, size: 75, rooms: 2, label: "A+++", status: "Verkocht" },
{ address: "Bergweg 104-J", price: 350000, size: 50, rooms: 1, label: "A+++", status: "Verkocht" },
{ address: "Bergweg 61-A", price: 409000, size: 107, rooms: 2, label: "C", status: "Verkocht" },
{ address: "Bergweg 104-T", price: 270000, size: 50, rooms: 1, label: "A++", status: "Verkocht" },
{ address: "Bergweg 112-F", price: 500000, size: 75, rooms: 2, label: "A+++", status: "Verkocht" },
{ address: "Bergweg 310", price: 750000, size: 247, rooms: 6, label: "D", status: "Verkocht" },
{ address: "Bergweg 88-F", price: 325000, size: 75, rooms: 2, label: "A", status: "Onder voorbehoud" },
{ address: "Bergweg 98-B", price: 625000, size: 114, rooms: 4, label: "A", status: "Onder voorbehoud" },
{ address: "Bergweg 330-C", price: 425000, size: 140, rooms: 3, label: "D", status: "Verkocht" },
{ address: "Bergweg 108-J", price: 340000, size: 50, rooms: 1, label: "A+++", status: "Verkocht" },
{ address: "Bergweg 106-A", price: 495000, size: 71, rooms: 2, label: "A+++", status: "Verkocht" },
{ address: "Bergweg 106-B", price: 450000, size: 68, rooms: 2, label: "A+++", status: "Verkocht" },
{ address: "Bergweg 255-A", price: 550000, size: 117, rooms: 2, label: "B", status: "Verkocht" },
{ address: "Bergweg 236-B", price: 395000, size: 137, rooms: 6, label: "F", status: "Verkocht" },
{ address: "Bergweg 205-A01 (huis)", price: 795000, size: 265, rooms: 4, label: "?", status: "Beschikbaar" },
{ address: "Bergweg 205-A01 (app)", price: 352500, size: 61, rooms: 2, label: "A+++", status: "Beschikbaar" },
{ address: "Bergweg 205-B", price: 699500, size: 128, rooms: 3, label: "A+++", status: "Beschikbaar" },
{ address: "Bergweg 53-A", price: 500000, size: 108, rooms: 3, label: "C", status: "Onder voorbehoud" },
{ address: "Bergweg 311-A", price: 329000, size: 67, rooms: 2, label: "B", status: "Onder voorbehoud" },
{ address: "Bergweg 65-A", price: 475000, size: 110, rooms: 3, label: "E", status: "Onder voorbehoud" },
{ address: "Bergweg 116-B", price: 450000, size: 77, rooms: 1, label: "A++", status: "Onder voorbehoud" },
{ address: "Bergweg 253-B", price: 625000, size: 111, rooms: 3, label: "A", status: "Onder bod" },
{ address: "Bergweg 309-B", price: 499500, size: 112, rooms: 3, label: "A", status: "Verkocht" },
{ address: "Bergweg 148-A", price: 350000, size: 66, rooms: 1, label: "A", status: "Verkocht" },
{ address: "Bergweg 153-B", price: 325000, size: 55, rooms: 2, label: "A", status: "Verkocht" },
{ address: "Bergweg 240-A", price: 499500, size: 91, rooms: 2, label: "D", status: "Verkocht" },
{ address: "Bergweg 39-D", price: 385000, size: 115, rooms: 5, label: "D", status: "Verkocht" },
{ address: "Bergweg 155-D", price: 345000, size: 65, rooms: 1, label: "A", status: "Verkocht" },
{ address: "Bergweg 282-C", price: 350000, size: 80, rooms: 2, label: "C", status: "Verkocht" },
{ address: "Bergweg 106-C", price: 360000, size: 50, rooms: 1, label: "A++", status: "Verkocht" },
{ address: "Bergweg 129-a", price: 495000, size: 144, rooms: 3, label: "C", status: "Verkocht" },
{ address: "Bergweg 47-C", price: 280000, size: 61, rooms: 2, label: "E", status: "Verkocht" },
{ address: "Bergweg 236-A", price: 499500, size: 117, rooms: 4, label: "A", status: "Verkocht" },
{ address: "Bergweg 102-B", price: 425000, size: 107, rooms: 3, label: "C", status: "Verkocht" },
{ address: "Bergweg 162-A", price: 600000, size: 142, rooms: 2, label: "A", status: "Verkocht" },
{ address: "Bergweg 55-C", price: 315000, size: 59, rooms: 2, label: "B", status: "Verkocht" },
{ address: "Bergweg 365-A03", price: 425000, size: 102, rooms: 2, label: "C", status: "Actief" },
{ address: "Bleiswijkstraat 19", price: 400000, size: 75, rooms: 2, label: "A", status: "Actief" },
{ address: "Vijverhofstraat 175-B01", price: 350000, size: 63, rooms: 2, label: "C", status: "Actief" },
{ address: "Bergweg 277-B", price: 699000, size: 153, rooms: 4, label: "B", status: "Actief" },
{ address: "Bergweg 175-C03", price: 450000, size: 81, rooms: 2, label: "E", status: "Actief" },
{ address: "Schieweg 7-A02", price: 329000, size: 81, rooms: 3, label: "C", status: "Actief" },
{ address: "Bergweg 233-A", price: 500000, size: 149, rooms: 4, label: "C", status: "Actief" },
{ address: "Noordsingel 139", price: 600000, size: 160, rooms: 2, label: "D", status: "Actief" },
{ address: "Bergselaan 15-A", price: 479000, size: 97, rooms: 2, label: "C", status: "Actief" },
{ address: "Bergweg 219", price: 2000000, size: 460, rooms: 14, label: "?", status: "Actief" },
{ address: "Bergweg 99-b", price: 700000, size: 203, rooms: 6, label: "E", status: "Actief" },
{ address: "Agniesestraat 136-b", price: 550000, size: 124, rooms: 3, label: "C", status: "Actief" },
{ address: "Schiebroeksestraat 10", price: 650000, size: 164, rooms: 4, label: "C", status: "Actief" },
{ address: "Blommersdijkselaan 38-A", price: 675000, size: 134, rooms: 4, label: "D", status: "Actief" },
{ address: "Heer Vrankestraat 15", price: 825000, size: 175, rooms: 4, label: "A++", status: "Actief" },
{ address: "Willebrordusplein 9-A", price: 650000, size: 110, rooms: 2, label: "A", status: "Actief" },
{ address: "Soetendaalseweg 11", price: 700000, size: 152, rooms: 3, label: "A+++", status: "Actief" },
{ address: "Schiekade 4-B", price: 1350000, size: 385, rooms: 4, label: "C", status: "Actief" },
{ address: "Blommersdijkselaan 13-A", price: 575000, size: 118, rooms: 2, label: "A", status: "Actief" },
{ address: "Willebrordusstraat 66", price: 450000, size: 86, rooms: 2, label: "A", status: "Actief" },
{ address: "Van den Hoonaardstraat 18-A", price: 650000, size: 119, rooms: 3, label: "A+", status: "Actief" },
{ address: "Van den Hoonaardstraat 18-B", price: 600000, size: 116, rooms: 2, label: "A", status: "Actief" },
{ address: "Bergweg 239-A", price: 550000, size: 150, rooms: 4, label: "C", status: "Actief" },
{ address: "Bergweg 324-B", price: 585000, size: 153, rooms: 3, label: "E", status: "Actief" },
{ address: "Bergweg 250-A", price: 650000, size: 133, rooms: 3, label: "A", status: "Actief" },
{ address: "Rodenrijselaan 62-A02", price: 495000, size: 118, rooms: 3, label: "A", status: "Actief" },
{ address: "Bergweg 108-M", price: 525000, size: 75, rooms: 2, label: "A+++", status: "Actief" },
{ address: "Insulindestraat 289-A", price: 725000, size: 149, rooms: 2, label: "D", status: "Actief" },
{ address: "Soetendaalseweg 62-B01", price: 309500, size: 55, rooms: 2, label: "C", status: "Actief" },
{ address: "Rodenrijselaan 14-B", price: 400000, size: 130, rooms: 5, label: "E", status: "Actief" },
{ address: "Bergstraat 30-A", price: 450000, size: 93, rooms: 5, label: "B", status: "Actief" },
{ address: "Blommersdijkselaan 30-B", price: 599000, size: 110, rooms: 4, label: "A", status: "Actief" },
{ address: "Bergweg 253-A", price: 675000, size: 116, rooms: 3, label: "A", status: "Actief" },
{ address: "Gordelweg 55-C", price: 275000, size: 55, rooms: 1, label: "D", status: "Verkocht" },
{ address: "Rodenrijselaan 64-A02", price: 317500, size: 71, rooms: 1, label: "A", status: "Verkocht" },
{ address: "Bergselaan 154-B", price: 650000, size: 133, rooms: 4, label: "D", status: "Verkocht" },
{ address: "Blommersdijkselaan 9-A", price: 575000, size: 161, rooms: 5, label: "E", status: "Verkocht" },
{ address: "Blommersdijkselaan 7-A", price: 575000, size: 161, rooms: 4, label: "E", status: "Verkocht" },
{ address: "Gordelweg 52-C", price: 500000, size: 116, rooms: 3, label: "D", status: "Verkocht" },
{ address: "Bergselaan 148", price: 1195000, size: 253, rooms: 6, label: "A", status: "Verkocht" },
{ address: "Rodenrijselaan 64-A01", price: 325000, size: 71, rooms: 1, label: "A", status: "Verkocht" },
{ address: "Sint-Agathastraat 8-B", price: 375000, size: 70, rooms: 2, label: "C", status: "Verkocht" },
{ address: "Lisstraat 40-A", price: 625000, size: 110, rooms: 3, label: "A", status: "Verkocht" },
{ address: "Benthuizerstraat 60-G", price: 275000, size: 52, rooms: 1, label: "D", status: "Verkocht" },
{ address: "Willebrordusstraat 28-A", price: 485000, size: 98, rooms: 3, label: "C", status: "Verkocht" },
{ address: "Banierstraat 27-C02", price: 360000, size: 69, rooms: 1, label: "C", status: "Verkocht" },
{ address: "Bergselaan 192-A", price: 537000, size: 118, rooms: 3, label: "C", status: "Verkocht" },
{ address: "Bergselaan 54-B", price: 345000, size: 59, rooms: 1, label: "C", status: "Verkocht" },
{ address: "Bergselaan 136-B", price: 695000, size: 150, rooms: 4, label: "B", status: "Verkocht" },
{ address: "Gordelweg 35-D", price: 309000, size: 61, rooms: 1, label: "E", status: "Verkocht" },
{ address: "Noordsingel 153-A", price: 419500, size: 78, rooms: 2, label: "A", status: "Verkocht" },
{ address: "Willebrordusstraat 18", price: 695000, size: 202, rooms: 2, label: "C", status: "Verkocht" },
{ address: "Schiekade 440", price: 399000, size: 84, rooms: 2, label: "A+", status: "Verkocht" },
{ address: "Voorburgstraat 244", price: 450000, size: 93, rooms: 2, label: "B", status: "Verkocht" },
{ address: "Bergselaan 74-B", price: 489500, size: 119, rooms: 3, label: "D", status: "Verkocht" },
{ address: "Bergselaan 206-A", price: 900000, size: 202, rooms: 5, label: "C", status: "Verkocht" },
{ address: "Schout Heynricstraat 60", price: 400000, size: 94, rooms: 4, label: "B", status: "Verkocht" },
{ address: "Sint-Agathastraat 58-A", price: 565000, size: 110, rooms: 4, label: "B", status: "Verkocht" },
{ address: "Benthuizerstraat 60-B", price: 300000, size: 59, rooms: 2, label: "C", status: "Verkocht" },
{ address: "Gordelweg 23-D", price: 315000, size: 63, rooms: 1, label: "E", status: "Verkocht" },
{ address: "Schiekade 42-B", price: 449000, size: 122, rooms: 2, label: "C", status: "Verkocht" },
{ address: "Van den Hoonaardstraat 25-A", price: 400000, size: 97, rooms: 4, label: "B", status: "Verkocht" },
{ address: "Zestienhovenstraat 34", price: 700000, size: 149, rooms: 4, label: "C", status: "Verkocht" },
{ address: "Bergselaan 174-A", price: 750000, size: 131, rooms: 4, label: "B", status: "Verkocht" },
{ address: "Bleiswijkstraat 105-A", price: 319500, size: 55, rooms: 1, label: "A", status: "Verkocht" },
{ address: "Schout Heynricstraat 44", price: 445000, size: 89, rooms: 3, label: "C", status: "Verkocht" },
{ address: "Bleiswijkstraat 105-B", price: 365000, size: 56, rooms: 1, label: "A", status: "Verkocht" },
{ address: "Zestienhovenstraat 36", price: 700000, size: 135, rooms: 5, label: "A", status: "Verkocht" },
{ address: "Sint-Agathastraat 21-B", price: 795000, size: 182, rooms: 3, label: "A", status: "Verkocht" },
{ address: "Gerard Scholtenstraat 110-B", price: 315000, size: 48, rooms: 1, label: "A", status: "Verkocht" },
{ address: "Bergselaan 32-C", price: 380000, size: 95, rooms: 5, label: "C", status: "Verkocht" },
{ address: "Sint-Agathastraat 19-A", price: 765000, size: 153, rooms: 3, label: "A", status: "Verkocht" },
{ address: "Van den Hoonaardstraat 14-C", price: 329000, size: 54, rooms: 2, label: "D", status: "Verkocht" },
{ address: "Soetendaalseweg 89-A", price: 575000, size: 108, rooms: 3, label: "A", status: "Verkocht" },
{ address: "Vijverhofstraat 181", price: 575000, size: 121, rooms: 4, label: "D", status: "Verkocht" },
{ address: "Gordelweg 66-C", price: 460000, size: 116, rooms: 1, label: "C", status: "Verkocht" },
{ address: "Bergstraat 11-A", price: 350000, size: 92, rooms: 3, label: "D", status: "Verkocht" },
{ address: "Van den Hoonaardstraat 8", price: 695000, size: 192, rooms: 5, label: "E", status: "Verkocht" },
{ address: "Rodenrijselaan 62-B", price: 479500, size: 112, rooms: 1, label: "C", status: "Verkocht" },
{ address: "Schout Heynricstraat 78", price: 475000, size: 90, rooms: 3, label: "C", status: "Verkocht" },
{ address: "Bleiswijkstraat 67", price: 389000, size: 75, rooms: 2, label: "C", status: "Verkocht" },
{ address: "Schieveenstraat 13-A", price: 595000, size: 144, rooms: 2, label: "C", status: "Verkocht" },
{ address: "Bergstraat 11-C", price: 350000, size: 76, rooms: 4, label: "D", status: "Verkocht" },
{ address: "Schiebroekselaan 60-B", price: 550000, size: 120, rooms: 3, label: "D", status: "Verkocht" },
{ address: "Gerard Scholtenstraat 112-A", price: 650000, size: 134, rooms: 3, label: "G", status: "Verkocht" },
{ address: "Koningsveldestraat 9-B", price: 550000, size: 101, rooms: 3, label: "D", status: "Verkocht" },
{ address: "Blommersdijkselaan 36", price: 1195000, size: 250, rooms: 5, label: "B", status: "Verkocht" },
{ address: "Rodenrijselaan 27-A", price: 635000, size: 156, rooms: 4, label: "D", status: "Verkocht" },
{ address: "Willebrordusplein 7-B", price: 235000, size: 53, rooms: 1, label: "G", status: "Verkocht" },
{ address: "Willebrordusstraat 81-B02", price: 295000, size: 101, rooms: 3, label: "C", status: "Verkocht" },
{ address: "Gordelweg 63-C", price: 325000, size: 55, rooms: 1, label: "D", status: "Verkocht" },
{ address: "Bergweg 307-A", price: 450000, size: 79, rooms: 2, label: "A", status: "Onder voorbehoud" },
{ address: "doctor Hekmanstraat 8", price: 395000, size: 77, rooms: 2, label: "A", status: "Verkocht" },
{ address: "Schieveenstraat 46", price: 695000, size: 160, rooms: 4, label: "C", status: "Verkocht" },
{ address: "Bergselaan 150", price: 1125000, size: 257, rooms: 5, label: "A", status: "Verkocht" },
{ address: "Heer Vrankestraat 25-A", price: 699000, size: 129, rooms: 4, label: "A", status: "Verkocht" },
{ address: "Hooglandstraat 190", price: 395000, size: 58, rooms: 2, label: "A", status: "Actief" },
{ address: "Zwart Janstraat 126-A", price: 400000, size: 127, rooms: 4, label: "D", status: "Actief" },
{ address: "Van den Hoonaardstraat 22-B", price: 435000, size: 105, rooms: 2, label: "D", status: "Verkocht" },
{ address: "Bergsingel 208-A", price: 650000, size: 115, rooms: 3, label: "D", status: "Verkocht" },
{ address: "Bergselaan 13-B", price: 395000, size: 70, rooms: 1, label: "B", status: "Verkocht" },
{ address: "Rodenrijselaan 43-B02", price: 500000, size: 168, rooms: 4, label: "G", status: "Verkocht" },
{ address: "Bergselaan 166-A", price: 675000, size: 133, rooms: 3, label: "C", status: "Verkocht" },
{ address: "Van den Hoonaardstraat 15-B", price: 465000, size: 117, rooms: 2, label: "D", status: "Verkocht" },
{ address: "Noordsingel 185-J", price: 925000, size: 143, rooms: 3, label: "A", status: "Verkocht" },
{ address: "Bergselaan 36-D", price: 365000, size: 65, rooms: 1, label: "C", status: "Verkocht" },
{ address: "Willebrordusplein 17-A", price: 475000, size: 107, rooms: 2, label: "C", status: "Verkocht" },
{ address: "Lisstraat 51-A", price: 569000, size: 113, rooms: 3, label: "C", status: "Verkocht" },
{ address: "Benthuizerstraat 8-A", price: 399000, size: 85, rooms: 3, label: "?", status: "Verkocht" },
{ address: "Rodenrijselaan 64-B", price: 475000, size: 132, rooms: 3, label: "A", status: "Verkocht" },
{ address: "Schiekade 14-M", price: 350000, size: 71, rooms: 1, label: "?", status: "Verkocht" },
{ address: "Sint-Agathastraat 8-A", price: 425000, size: 75, rooms: 2, label: "C", status: "Onder voorbehoud" },
{ address: "Schiekade 504", price: 465000, size: 86, rooms: 2, label: "A", status: "Onder voorbehoud" },
{ address: "Bloklandstraat 155-B", price: 395000, size: 107, rooms: 2, label: "E", status: "Onder voorbehoud" },
{ address: "Zestienhovenstraat 21", price: 650000, size: 138, rooms: 5, label: "A+", status: "Verkocht" },
{ address: "Bergweg 205-A01", price: 795000, size: 265, rooms: 4, label: "?", status: "Verkocht" },
{ address: "Bergweg 205-A02", price: 392750, size: 69, rooms: 2, label: "A+++", status: "Verkocht" },
{ address: "Bergweg 205-A01", price: 352500, size: 61, rooms: 2, label: "A+++", status: "Verkocht" },
{ address: "Bergweg 205-B", price: 699500, size: 128, rooms: 3, label: "A+++", status: "Verkocht" },
{ address: "Van den Hoonaardstraat 21-B", price: 435000, size: 100, rooms: 3, label: "E", status: "Verkocht" },
{ address: "Schiekade 492", price: 265000, size: 105, rooms: 2, label: "?", status: "Verkocht" },
{ address: "Bergselaan 30-D", price: 310000, size: 82, rooms: 2, label: "E", status: "Actief" },
{ address: "Willebrordusplein 13-K", price: 489000, size: 73, rooms: 2, label: "?", status: "Actief" },
{ address: "Willebrordusplein 13-G", price: 499500, size: 73, rooms: 2, label: "?", status: "Actief" },
{ address: "Willebrordusplein 13-E", price: 489000, size: 73, rooms: 2, label: "?", status: "Actief" },
{ address: "Willebrordusplein 13-D", price: 489000, size: 73, rooms: 2, label: "?", status: "Actief" },
{ address: "Soetendaalseweg 107", price: 770000, size: 110, rooms: 3, label: "A+++", status: "Actief" },
{ address: "Soetendaalseweg 109", price: 770000, size: 110, rooms: 3, label: "A+++", status: "Actief" },
{ address: "Bergweg 72", price: 672000, size: 96, rooms: 3, label: "A+++", status: "Actief" },
{ address: "Insulindestraat 283-A03", price: 475000, size: 68, rooms: 2, label: "A++", status: "Actief" },
{ address: "Schiekade 14-l", price: 450000, size: 94, rooms: 2, label: "B", status: "Actief" },
{ address: "Insulindestraat 283-A01", price: 375000, size: 51, rooms: 1, label: "A++", status: "Actief" },
{ address: "Soetendaalseweg 111", price: 763000, size: 109, rooms: 3, label: "?", status: "Actief" },
{ address: "Woning F (Bouwnr. F1)", price: 450000, size: 75, rooms: 3, label: "A++++", status: "Nieuwbouw" },
{ address: "Woning E (Bouwnr. E1)", price: 770000, size: 110, rooms: 3, label: "A++++", status: "Nieuwbouw" },
{ address: "Woning D (Bouwnr. D1)", price: 770000, size: 110, rooms: 3, label: "A++++", status: "Nieuwbouw" },
{ address: "Woning C (Bouwnr. C1)", price: 763000, size: 109, rooms: 3, label: "A++++", status: "Nieuwbouw" },
{ address: "Willebrordusstraat 102-A", price: 450000, size: 168, rooms: 4, label: "?", status: "Verkocht" },
{ address: "Insulindestraat 256-Z", price: 571500, size: 78, rooms: 3, label: "A+++", status: "Verkocht" },
{ address: "Woning A (Bouwnr. 1)", price: 672000, size: 96, rooms: 3, label: "A++++", status: "Nieuwbouw" },
{ address: "Hoyledestraat (Bouwnr. 41e)", price: 319500, size: 44, rooms: 1, label: "B", status: "Verkocht" },
{ address: "Hoyledestraat (Bouwnr. 41a)", price: 339500, size: 45, rooms: 1, label: "B", status: "Verkocht" },
{ address: "Hoyledestraat 41d", price: 289500, size: 39, rooms: 1, label: "B", status: "Verkocht" },
{ address: "Hoyledestraat (Bouwnr. 41c)", price: 249500, size: 35, rooms: 1, label: "B", status: "Verkocht" },
{ address: "Hoyledestraat (Bouwnr. 37)", price: 225000, size: 41, rooms: 1, label: "B", status: "Verkocht" },
{ address: "Hoyledestraat (Bouwnr. 41b)", price: 247500, size: 32, rooms: 1, label: "B", status: "Verkocht" },
{ address: "Hoyledestraat 41", price: 330000, size: 70, rooms: 2, label: "?", status: "Verkocht" },
{ address: "Hoyledestraat 35", price: 635000, size: 144, rooms: 4, label: "?", status: "Verkocht" },
{ address: "Soetendaalseweg (Bouwnr. 99A)", price: 489500, size: 71, rooms: 2, label: "B", status: "Verkocht" },
{ address: "Soetendaalseweg 99-C", price: 565000, size: 85, rooms: 2, label: "?", status: "Verkocht" },
{ address: "Schiekade 46-F", price: 200000, size: 25, rooms: 1, label: "A", status: "Onder voorbehoud" },
{ address: "Rodenrijselaan 9-A03", price: 350000, size: 62, rooms: 1, label: "E", status: "Onder voorbehoud" },
{ address: "Benthuizerstraat 32-A", price: 375000, size: 101, rooms: 2, label: "D", status: "Onder voorbehoud" },
{ address: "Noordsingel 159-C", price: 395000, size: 76, rooms: 2, label: "B", status: "Onder voorbehoud" },
{ address: "Bergselaan 130-A", price: 750000, size: 136, rooms: 3, label: "C", status: "Onder voorbehoud" },
];

    /* ---------------------------------------------
       2. Preprocessing & basis-statistieken
    --------------------------------------------- */
    const propsWithM2 = properties
      .filter(p => p.size > 0)
      .map(p => ({
        ...p,
        pricePerM2: Math.round(p.price / p.size)
      }));

    const avg = arr =>
      arr.length ? Math.round(arr.reduce((s, v) => s + v, 0) / arr.length) : 0;

    const avgM2    = avg(propsWithM2.map(p => p.pricePerM2));
    const avgPrice = avg(propsWithM2.map(p => p.price));
    const avgSize  = avg(propsWithM2.map(p => p.size));

    const maxM2 = Math.max(...propsWithM2.map(p => p.pricePerM2));
    const minM2 = Math.min(...propsWithM2.map(p => p.pricePerM2));

    const soldCount = properties.filter(p => p.status === "Verkocht").length;
    const soldPct   = Math.round((soldCount / properties.length) * 100);

    const AplusCount = properties.filter(p => p.label && p.label.startsWith("A")).length;
    const AplusPct   = Math.round((AplusCount / properties.length) * 100);

    const m2Ranges = [
      { range: "‚Ç¨3.000‚Äì‚Ç¨4.000", min: 3000, max: 4000, count: 0 },
      { range: "‚Ç¨4.000‚Äì‚Ç¨5.000", min: 4000, max: 5000, count: 0 },
      { range: "‚Ç¨5.000‚Äì‚Ç¨6.000", min: 5000, max: 6000, count: 0 },
      { range: "‚Ç¨6.000‚Äì‚Ç¨7.000", min: 6000, max: 7000, count: 0 },
      { range: "‚Ç¨7.000+",      min: 7000, max: 20000, count: 0 }
    ];

    propsWithM2.forEach(p => {
      const r = m2Ranges.find(x => p.pricePerM2 >= x.min && p.pricePerM2 < x.max);
      if (r) r.count++;
    });

    /* ---------------------------------------------
       3. KPI's invullen
    --------------------------------------------- */
    document.getElementById("kpis").innerHTML = `
      <div class="bg-white p-6 shadow rounded">
        <p class="text-sm text-gray-600">Gemiddelde prijs/m¬≤</p>
        <p class="text-2xl font-bold text-blue-600">‚Ç¨${avgM2.toLocaleString()}</p>
      </div>
      <div class="bg-white p-6 shadow rounded">
        <p class="text-sm text-gray-600">Gemiddelde prijs</p>
        <p class="text-2xl font-bold text-green-600">‚Ç¨${avgPrice.toLocaleString()}</p>
      </div>
      <div class="bg-white p-6 shadow rounded">
        <p class="text-sm text-gray-600">Gem. oppervlakte</p>
        <p class="text-2xl font-bold text-purple-600">${avgSize} m¬≤</p>
      </div>
    `;

    /* ---------------------------------------------
       4. Insights invullen
    --------------------------------------------- */
    const addInsight = txt => {
      const ul = document.getElementById("insights");
      const li = document.createElement("li");
      li.className = "flex items-start";
      li.innerHTML = `<span class='text-blue-500 mr-2'>‚Ä¢</span>${txt}`;
      ul.appendChild(li);
    };

    addInsight(`Gemiddelde prijs per m¬≤: <strong>‚Ç¨${avgM2.toLocaleString()}</strong>.`);
    addInsight(`${soldPct}% van alle woningen is verkocht (${soldCount} van de ${properties.length}).`);
    addInsight(`Laagste m¬≤-prijs: ‚Ç¨${minM2.toLocaleString()}. Hoogste: ‚Ç¨${maxM2.toLocaleString()}.`);
    addInsight(`${AplusPct}% van de woningen heeft energielabel A of hoger (${AplusCount} woningen).`);

    /* ---------------------------------------------
       5. Details tabel
    --------------------------------------------- */
    const tableBody = document.getElementById("table-body");

    propsWithM2
      .slice()
      .sort((a, b) => b.pricePerM2 - a.pricePerM2)
      .forEach(p => {
        tableBody.innerHTML += `
          <tr class="border-b">
            <td class="px-4 py-2">${p.address}</td>
            <td class="px-4 py-2">‚Ç¨${p.price.toLocaleString()}</td>
            <td class="px-4 py-2">${p.size}</td>
            <td class="px-4 py-2 text-blue-600 font-bold">‚Ç¨${p.pricePerM2.toLocaleString()}</td>
            <td class="px-4 py-2">${p.status}</td>
          </tr>
        `;
      });

    /* ---------------------------------------------
       6. Grafiek 1 ‚Äì Bar: verdeling prijs/m¬≤
    --------------------------------------------- */
    new Chart(
      document.getElementById("chart-m2ranges"),
      {
        type: "bar",
        data: {
          labels: m2Ranges.map(r => r.range),
          datasets: [{
            label: "Aantal woningen",
            data: m2Ranges.map(r => r.count),
            backgroundColor: "#3b82f6"
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: { beginAtZero: true }
          }
        }
      }
    );

    /* ---------------------------------------------
       7. Grafiek 2 ‚Äì Heatmap: m¬≤-prijs vs kamers
    --------------------------------------------- */
    const heatmapMatrix = {};
    propsWithM2.forEach(p => {
      if (!heatmapMatrix[p.rooms]) heatmapMatrix[p.rooms] = [];
      heatmapMatrix[p.rooms].push(p.pricePerM2);
    });

    const heatmapLabels = Object.keys(heatmapMatrix).sort((a, b) => a - b);
    const heatmapValues = heatmapLabels.map(r => {
      const arr = heatmapMatrix[r];
      return avg(arr);
    });

    const heatColors = heatmapValues.map(v => {
      const ratio = (v - minM2) / (maxM2 - minM2 || 1);
      const red = Math.round(255 * ratio);
      const green = Math.round(255 * (1 - ratio));
      return `rgb(${red}, ${green}, 80)`;
    });

    new Chart(document.getElementById("chart-heatmap"), {
      type: "bar",
      data: {
        labels: heatmapLabels.map(l => `${l} kamers`),
        datasets: [{
          data: heatmapValues,
          backgroundColor: heatColors,
          borderWidth: 1
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: {
          y: { beginAtZero: false, title: { display: true, text: "‚Ç¨ per m¬≤" } }
        }
      }
    });

    /* ---------------------------------------------
       8. Grafiek 3 ‚Äì Bar: Gem. m¬≤-prijs per label
    --------------------------------------------- */
    const labelGroups = {};
    propsWithM2.forEach(p => {
      if (!p.label || p.label === "?") return;
      if (!labelGroups[p.label]) labelGroups[p.label] = [];
      labelGroups[p.label].push(p.pricePerM2);
    });

    const labelNames = Object.keys(labelGroups).sort();
    const labelAvg = labelNames.map(l => avg(labelGroups[l]));

    new Chart(document.getElementById("chart-labels"), {
      type: "bar",
      data: {
        labels: labelNames,
        datasets: [{
          label: "Gem. ‚Ç¨ / m¬≤",
          data: labelAvg,
          backgroundColor: "#10b981"
        }]
      },
      options: {
        plugins: {
          legend: { display: false }
        },
        scales: {
          y: { beginAtZero: false }
        }
      }
    });

    /* ---------------------------------------------
       9. Grafiek 4 ‚Äì Lijn: (gesimuleerde) trend
    --------------------------------------------- */
    const months = ["Jan", "Feb", "Mrt", "Apr", "Mei", "Jun", "Jul", "Aug", "Sep"];
    const trendData = months.map(() => {
      // Simpele simulatie: rond gemiddelde prijs
      return avgPrice * (0.95 + Math.random() * 0.1);
    });

    new Chart(document.getElementById("chart-trend"), {
      type: "line",
      data: {
        labels: months,
        datasets: [{
          label: "Gemiddelde vraagprijs (simulatie)",
          data: trendData,
          borderColor: "#3b82f6",
          tension: 0.4,
          fill: false
        }]
      },
      options: {
        plugins: {
          legend: { display: false }
        },
        scales: {
          y: {
            ticks: {
              callback: value => "‚Ç¨" + (value / 1000).toFixed(0) + "k"
            }
          }
        }
      }
    });

    /* ---------------------------------------------
       10. Scatterchart helper ‚Äì wordt later ook
           gebruikt voor jouw woning (highlight)
    --------------------------------------------- */
    let scatterChart;

    function buildScatter(highlight = null) {
      if (scatterChart) scatterChart.destroy();

      const allPoints = propsWithM2.map(p => ({
        x: p.size,
        y: p.price,
        address: p.address
      }));

      const datasets = [
        {
          label: "Overige woningen",
          data: allPoints,
          pointRadius: 5,
          backgroundColor: "#8884d8"
        }
      ];

      if (highlight) {
        datasets.push({
          label: "Jouw woning",
          data: [highlight],
          pointRadius: 9,
          backgroundColor: "red"
        });
      }

      scatterChart = new Chart(
        document.getElementById("chart-scatter"),
        {
          type: "scatter",
          data: { datasets },
          options: {
            plugins: {
              tooltip: {
                callbacks: {
                  label: ctx => {
                    const d = ctx.raw;
                    const price = d.y.toLocaleString();
                    const size  = d.x;
                    const addr  = d.address || "Jouw woning";
                    return `${addr}: ${size} m¬≤ ‚Äì ‚Ç¨${price}`;
                  }
                }
              },
              legend: { display: true }
            },
            scales: {
              x: { title: { display: true, text: "Oppervlakte (m¬≤)" } },
              y: {
                title: { display: true, text: "Vraagprijs (‚Ç¨)" },
                ticks: {
                  callback: value => "‚Ç¨" + (value / 1000).toFixed(0) + "k"
                }
              }
            }
          }
        }
      );
    }

    // initial scatter zonder highlight
    buildScatter();
/* ---------------------------------------------
   11. Tabswitching
--------------------------------------------- */
document.querySelectorAll(".tab-btn").forEach(btn => {
  btn.onclick = () => {
    const tab = btn.dataset.tab;

    // Buttons resetten
    document.querySelectorAll(".tab-btn").forEach(b => {
      b.classList.remove("border-blue-600", "border-b-2", "text-blue-600");
      b.classList.add("text-gray-600");
    });

    // Actieve button
    btn.classList.add("border-b-2", "border-blue-600", "text-blue-600");

    // Alle tab-content verbergen
    document.querySelectorAll("[id^='tab-']").forEach(div =>
      div.classList.add("hidden")
    );

    // Gewenste tab tonen
    document.getElementById("tab-" + tab).classList.remove("hidden");
  };
});


/* ---------------------------------------------
   12. Geavanceerd waarderingsmodel ‚Äî AI Taxatie (HERSCHREVEN)
--------------------------------------------- */

function calculateValueDetailed({ size, rooms, label, bouwjaar, onderhoud, erfpacht, servicekosten, buitenruimte }) {

const breakdown = [];

let m2 = avgM2;
breakdown.push({ stap: "Startwaarde", waarde: Math.round(m2), factor: 1 });

/* ------------------------------------------
   1. ENERGIELABEL
------------------------------------------ */
const labelFactorMap = {
  "A+++": 1.06,
  "A++": 1.05,
  "A+": 1.04,
  "A": 1.03,
  "B": 1.00,
  "C": 0.97,
  "D": 0.94,
  "E": 0.91,
  "F": 0.88,
  "?": 0.96
};

const fLabel = labelFactorMap[label] || 1;
m2 *= fLabel;
breakdown.push({
  stap: `Energielabel (${label})`,
  factor: fLabel,
  waarde: Math.round(m2)
});

/* ------------------------------------------
   2. KAMERS
------------------------------------------ */
let fRooms = 1;
if (rooms >= 4) fRooms = 1.03;
else if (rooms === 3) fRooms = 1.015;
else if (rooms <= 2) fRooms = 0.97;

m2 *= fRooms;
breakdown.push({
  stap: `Kamercorrectie (${rooms} kamers)`,
  factor: fRooms,
  waarde: Math.round(m2)
});

/* ------------------------------------------
   3. ONDERHOUDSSTAAT
------------------------------------------ */
const maintFactorMap = {
  "slecht": 0.80,
  "matig": 0.90,
  "normaal": 1.00,
  "goed": 1.04,
  "luxe": 1.08,
  "zeer_luxe": 1.12
};

const fMaint = maintFactorMap[onderhoud] || 1;
m2 *= fMaint;
breakdown.push({
  stap: `Onderhoudsstaat (${onderhoud})`,
  factor: fMaint,
  waarde: Math.round(m2)
});

/* ------------------------------------------
   4. BOUWJAAR
------------------------------------------ */
let fYear = 1;

if (bouwjaar >= 2015) fYear = 1.06;
else if (bouwjaar >= 2000) fYear = 1.03;
else if (bouwjaar >= 1980) fYear = 1.00;
else if (bouwjaar >= 1945) fYear = 0.95;
else fYear = 0.92;

m2 *= fYear;
breakdown.push({
  stap: `Bouwjaar (${bouwjaar})`,
  factor: fYear,
  waarde: Math.round(m2)
});

/* ------------------------------------------
   5. BUITENRUIMTE
------------------------------------------ */
const outdoorPoints = {
  "geen": 0,
  "balkon": 8,
  "dakterras": 15,
  "tuin_klein": 25,
  "tuin_groot": 40
};

const ext = outdoorPoints[buitenruimte] || 0;
const fOutdoor = 1 + Math.min(ext / 200, 0.08);

m2 *= fOutdoor;
breakdown.push({
  stap: `Buitenruimte (${buitenruimte})`,
  factor: fOutdoor,
  waarde: Math.round(m2)
});

/* ------------------------------------------
   6. ERFPACHT
------------------------------------------ */
const erfMap = {
  "eigen": 1.00,
  "erfpacht_afgekocht": 0.97,
  "erfpacht_canon": 0.88
};

const fErf = erfMap[erfpacht] || 1;
m2 *= fErf;

breakdown.push({
  stap: `Grondsituatie (${erfpacht})`,
  factor: fErf,
  waarde: Math.round(m2)
});

/* ------------------------------------------
   7. SERVICEKOSTEN
------------------------------------------ */
let fService = 1;
if (servicekosten > 200) fService = 0.90;
else if (servicekosten > 150) fService = 0.94;
else if (servicekosten > 100) fService = 0.97;

m2 *= fService;
breakdown.push({
  stap: `Servicekosten (${servicekosten} p/m)`,
  factor: fService,
  waarde: Math.round(m2)
});

/* ------------------------------------------
   8. GROOTTESCHAAL (kleine woningen duurder)
------------------------------------------ */
let fSize = 1;
if (size < 60) fSize = 1.08;
else if (size < 80) fSize = 1.03;
else if (size > 140) fSize = 0.92;

m2 *= fSize;
breakdown.push({
  stap: `Grootte-effect (${size} m¬≤)`,
  factor: fSize,
  waarde: Math.round(m2)
});

/* ------------------------------------------
   EINDE
------------------------------------------ */
const estimatedValue = Math.round(size * m2);
const low = Math.round(estimatedValue * 0.94);
const high = Math.round(estimatedValue * 1.06);

return {
  m2: Math.round(m2),
  price: estimatedValue,
  low,
  high,
  breakdown
};
}

/* ---------------------------------------------
   13. Button ‚Üí Berekening & Scatter Highlight
--------------------------------------------- */
/* ---------------------------------------------
   13. Button ‚Üí Berekening, Scatter Highlight & Uitleg
--------------------------------------------- */
document.getElementById("btn-calc").onclick = () => {

const s = Number(document.getElementById("input-size").value);
const r = Number(document.getElementById("input-rooms").value);
const l = document.getElementById("input-label").value;

const bouwjaar = Number(document.getElementById("input-year").value || 1990);
const onderhoud = document.getElementById("input-condition").value;
const erfpacht = document.getElementById("input-lease").value;
const servicekosten = Number(document.getElementById("input-service").value || 0);
const buitenruimte = document.getElementById("input-outdoor").value;

if (!s) {
  alert("Voer minimaal woonoppervlakte in!");
  return;
}

const result = calculateValueDetailed({
  size: s,
  rooms: r,
  label: l,
  bouwjaar,
  onderhoud,
  erfpacht,
  servicekosten,
  buitenruimte
});

// Punt in scatter chart
buildScatter({ x: s, y: result.price, address: "Jouw woning" });

// Mooie lange berekening + uitleg
const totaleFactor = (result.m2 / avgM2) || 1;
const totaleFactorPct = ((totaleFactor - 1) * 100).toFixed(1);

const uitlegHtml = `
  <div class="bg-white border rounded p-4 space-y-4">
    <h3 class="font-semibold text-lg mb-1">üìê Stap-voor-stap berekening van de marktwaarde</h3>

    <!-- SAMENVATTING -->
    <div class="bg-gray-50 border border-gray-200 rounded p-3 text-sm">
      <p>
        We starten met de gemiddelde m¬≤-prijs in de referentiemarkt
        (<strong>‚Ç¨${avgM2.toLocaleString()}</strong> per m¬≤) en passen daar stap voor stap 
        correcties op toe voor <strong>energielabel, kamers, onderhoud, bouwjaar, 
        buitenruimte, grondsituatie, servicekosten</strong> en het 
        <strong>grootte-effect</strong> van je woning.
      </p>
    </div>

    <!-- TABEL: STAPPEN -->
    <div>
      <h4 class="font-semibold mb-2 text-sm uppercase tracking-wide text-gray-600">1. Correcties per factor</h4>
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm border border-gray-200 rounded">
          <thead class="bg-gray-100">
            <tr>
              <th class="px-3 py-2 text-left">Stap</th>
              <th class="px-3 py-2 text-right">Factor</th>
              <th class="px-3 py-2 text-right">Œî t.o.v. vorige</th>
              <th class="px-3 py-2 text-right">Nieuwe m¬≤-waarde</th>
            </tr>
          </thead>
          <tbody>
            ${result.breakdown.map((step, index) => {
              const prev = index === 0 ? step.waarde : result.breakdown[index - 1].waarde;
              const deltaPct = index === 0 
                ? "0.0%" 
                : (((step.waarde - prev) / prev) * 100).toFixed(1) + "%";
              return `
                <tr class="border-t">
                  <td class="px-3 py-2">${step.stap}</td>
                  <td class="px-3 py-2 text-right">${step.factor.toFixed(3)}</td>
                  <td class="px-3 py-2 text-right ${deltaPct.startsWith('-') ? 'text-red-600' : 'text-emerald-600'}">
                    ${deltaPct}
                  </td>
                  <td class="px-3 py-2 text-right">‚Ç¨${step.waarde.toLocaleString()}</td>
                </tr>
              `;
            }).join("")}
          </tbody>
        </table>
      </div>
    </div>

    <!-- FORMULE -->
    <div>
      <h4 class="font-semibold mb-1 text-sm uppercase tracking-wide text-gray-600">2. Formule marktwaarde</h4>
      <p class="text-sm">
        Na alle correcties komen we uit op een indicatieve m¬≤-prijs van  
        <strong>‚Ç¨${result.m2.toLocaleString()}</strong> per m¬≤
        (in totaal <strong>${totaleFactorPct}%</strong> verschil ten opzichte van het
        marktgemiddelde van ‚Ç¨${avgM2.toLocaleString()} per m¬≤).
      </p>
      <p class="mt-2 text-sm">
        De geschatte marktwaarde wordt dan berekend als:
      </p>
      <p class="mt-1 text-sm font-mono bg-gray-50 border border-gray-200 rounded px-3 py-2">
        waarde = woonoppervlakte √ó gecorrigeerde m¬≤-prijs<br>
        waarde = ${s} m¬≤ √ó ‚Ç¨${result.m2.toLocaleString()} ‚âà 
        <strong>‚Ç¨${result.price.toLocaleString()}</strong>
      </p>
    </div>

    <!-- BEREIK -->
    <div>
      <h4 class="font-semibold mb-1 text-sm uppercase tracking-wide text-gray-600">3. Waardebandbreedte</h4>
      <p class="text-sm">
        Omdat de markt nooit 100% exact is, tonen we een bandbreedte van ongeveer 
        <strong>¬±6%</strong> rondom de berekende waarde.
      </p>
      <p class="mt-1 text-sm">
        <strong>Indicatieve bandbreedte:</strong><br>
        <span class="inline-block mt-1 bg-blue-50 border border-blue-100 rounded px-3 py-1">
          ‚Ç¨${result.low.toLocaleString()} ‚Äì ‚Ç¨${result.high.toLocaleString()}
        </span>
      </p>
    </div>

    <!-- UITLEG IN WOORDEN -->
    <div>
      <h4 class="font-semibold mb-1 text-sm uppercase tracking-wide text-gray-600">4. Uitleg in woorden</h4>
      <p class="text-sm text-gray-800">
        Voor deze woning gaan we uit van <strong>${s} m¬≤</strong>, 
        <strong>${r || "onbekend aantal"} kamers</strong> en energielabel <strong>${l}</strong>.
        Het model kijkt naar vergelijkbare woningen in de buurt en corrigeert vervolgens voor:
      </p>
      <ul class="mt-2 text-sm list-disc list-inside text-gray-800 space-y-1">
        <li><strong>Energielabel</strong>: betere labels (A t/m A+++) krijgen een opslag, mindere labels een korting.</li>
        <li><strong>Aantal kamers</strong>: meer kamers bij hetzelfde aantal m¬≤ is aantrekkelijker, vooral voor gezinnen.</li>
        <li><strong>Onderhoud / afwerking</strong>: een luxe of zeer luxe afwerking tilt de m¬≤-waarde omhoog, matig/slecht drukt de prijs.</li>
        <li><strong>Bouwjaar</strong>: jongere bouwjaren scoren beter op isolatie, installaties en onderhoud.</li>
        <li><strong>Buitenruimte</strong>: balkon, dakterras of tuin voegen waarde toe ten opzichte van een woning zonder buitenruimte.</li>
        <li><strong>Grondsituatie</strong>: erfpacht (zeker met lopende canon) drukt de marktwaarde ten opzichte van eigen grond.</li>
        <li><strong>Servicekosten</strong>: hoge maandlasten via de VvE maken een woning minder betaalbaar en drukken de waarde.</li>
        <li><strong>Grootte-effect</strong>: kleinere woningen zijn relatief duurder per m¬≤; hele grote woningen juist iets goedkoper per m¬≤.</li>
      </ul>
      <p class="mt-3 text-sm text-gray-700">
        Dit is g√©√©n officieel taxatierapport, maar een datagedreven indicatie op basis van
        referentietransacties en een reeks marktcorrecties. Een taxateur kan bij een fysieke opname
        altijd nog extra aspecten meenemen (lichtinval, geluid, exacte ligging, staat van VvE, etc.).
      </p>
    </div>
  </div>
`;

document.getElementById("user-output").innerHTML = uitlegHtml;

document.getElementById("ai-valuation").innerHTML = `
  <strong>Waardebandbreedte (indicatief):</strong><br>
  ‚Ç¨${result.low.toLocaleString()} ‚Äì ‚Ç¨${result.high.toLocaleString()}
`;
};

/* ---------------------------------------------
   ADVANCED SECTION TOGGLE
--------------------------------------------- */
document.getElementById("toggle-adv").onclick = () => {
  const box = document.getElementById("adv-fields");
  const icon = document.getElementById("adv-icon");

  const isHidden = box.classList.contains("hidden");

  if (isHidden) {
    box.classList.remove("hidden");
    icon.textContent = "‚ñ≤";
  } else {
    box.classList.add("hidden");
    icon.textContent = "‚ñº";
  }
};

  </script>
</body>
</html>
