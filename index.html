<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Bergweg Analyse ‚Äì Marktwaardemeter</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body { background: #f3f4f6; }
    .input-label { font-size: 12px; font-weight: 600; color: #555; }
  </style>
</head>

<body class="bg-gray-100">
  <div id="app" class="w-full max-w-6xl mx-auto p-6">

    <!-- Titel -->
    <div class="bg-white p-6 shadow rounded mb-6">
      <h1 class="text-3xl font-bold">üè† Woningmarkt Analyse ‚Äì Bergweg Rotterdam</h1>
      <p class="text-gray-600 mt-1">
        Data van <strong>Funda</strong> ‚Äì realtime analyse van vraagprijzen, m¬≤-prijzen en woningtypes.
      </p>
    </div>

    <!-- KPI's -->
    <div id="kpis" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"></div>

    <!-- Jouw woning invoeren -->
    <div class="bg-white p-6 rounded shadow mb-6">
      <h2 class="text-xl font-semibold mb-4">üîç Vergelijk jouw woning</h2>

      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div>
          <label class="input-label">Woonoppervlakte (m¬≤)</label>
          <input id="input-size" type="number" class="w-full p-2 border rounded" placeholder="Bijv. 85">
        </div>
        <div>
          <label class="input-label">Aantal kamers</label>
          <input id="input-rooms" type="number" class="w-full p-2 border rounded" placeholder="Bijv. 3">
        </div>
        <div>
          <label class="input-label">Energielabel</label>
          <select id="input-label" class="w-full p-2 border rounded">
            <option value="A+++">A+++</option>
            <option value="A++">A++</option>
            <option value="A+">A+</option>
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C">C</option>
            <option value="D">D</option>
            <option value="E">E</option>
            <option value="F">F</option>
            <option value="?">Onbekend</option>
          </select>
        </div>
        <div>
          <label class="input-label">(Optioneel) Verw. vraagprijs</label>
          <input id="input-price" type="number" class="w-full p-2 border rounded" placeholder="Bijv. 395000">
        </div>
      </div>

      <button id="btn-calc"
        class="mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
        Analyseer woning
      </button>

      <div id="user-output" class="mt-4 text-gray-800 text-sm"></div>
    </div>

    <!-- Tabs -->
    <div class="bg-white shadow rounded">
      <div class="flex border-b">
        <button data-tab="overview" class="tab-btn px-6 py-3 border-b-2 border-blue-600 text-blue-600">
          Overzicht
        </button>
        <button data-tab="prices" class="tab-btn px-6 py-3 text-gray-600">
          Prijzen
        </button>
        <button data-tab="details" class="tab-btn px-6 py-3 text-gray-600">
          Details
        </button>
      </div>

      <div class="p-6">
        <!-- OVERZICHT -->
        <div id="tab-overview">
          <h2 class="text-lg font-semibold mb-4">Verdeling prijs per m¬≤</h2>
          <canvas id="chart-m2ranges" height="120"></canvas>
        </div>

        <!-- PRIJZEN -->
        <div id="tab-prices" class="hidden">
          <h2 class="text-lg font-semibold mb-4">Prijs vs. woonoppervlakte</h2>
          <canvas id="chart-scatter" height="140"></canvas>
        </div>

        <!-- DETAILS -->
        <div id="tab-details" class="hidden">
          <h2 class="text-lg font-semibold mb-4">Detailoverzicht</h2>
          <div class="overflow-x-auto">
            <table class="min-w-full bg-white rounded shadow">
              <thead class="bg-gray-100">
                <tr>
                  <th class="px-4 py-2 text-left">Adres</th>
                  <th class="px-4 py-2 text-left">Prijs</th>
                  <th class="px-4 py-2 text-left">m¬≤</th>
                  <th class="px-4 py-2 text-left">‚Ç¨/m¬≤</th>
                  <th class="px-4 py-2 text-left">Status</th>
                </tr>
              </thead>
              <tbody id="table-body"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- INSIGHTS -->
    <div class="bg-white rounded shadow mt-6 p-6">
      <h3 class="text-lg font-semibold mb-4">üìä Belangrijkste inzichten</h3>
      <ul id="insights" class="space-y-2 text-gray-700 text-sm"></ul>
    </div>

    <!-- AI WAARDERING -->
    <div class="bg-white rounded shadow mt-6 p-6">
      <h3 class="text-lg font-semibold mb-4">ü§ñ Marktwaardeschatting</h3>
      <p id="ai-valuation" class="text-gray-800 text-sm"></p>
    </div>
  </div>
  <script>
    /* ---------------------------------------------
       1. Data
    --------------------------------------------- */
    const properties = [
      { address: "Bergweg 365-A03", price: 425000, size: 102, rooms: 2, label: "C", status: "Beschikbaar" },
      { address: "Bergweg 277-B", price: 699000, size: 153, rooms: 4, label: "B", status: "Beschikbaar" },
      { address: "Bergweg 175-C03", price: 450000, size: 81, rooms: 2, label: "E", status: "Beschikbaar" },
      { address: "Bergweg 233-A", price: 500000, size: 149, rooms: 4, label: "C", status: "Beschikbaar" },
      { address: "Bergweg 324-B", price: 585000, size: 153, rooms: 3, label: "E", status: "Beschikbaar" },
      { address: "Bergweg 250-A", price: 650000, size: 133, rooms: 3, label: "A", status: "Beschikbaar" },
      { address: "Bergweg 108-M", price: 525000, size: 75, rooms: 2, label: "A+++", status: "Beschikbaar" },
      { address: "Bergweg 219", price: 2000000, size: 460, rooms: 14, label: "?", status: "Beschikbaar" },
      { address: "Bergweg 99-b", price: 700000, size: 203, rooms: 6, label: "E", status: "Beschikbaar" },
      { address: "Bergweg 239-A", price: 550000, size: 150, rooms: 4, label: "C", status: "Beschikbaar" },
      { address: "Bergweg 253-A", price: 675000, size: 116, rooms: 3, label: "A", status: "Verkocht" },
      { address: "Bergweg 365-A02", price: 419000, size: 93, rooms: 2, label: "B", status: "Verkocht" },
      { address: "Bergweg 143-A", price: 499500, size: 111, rooms: 2, label: "B", status: "Verkocht" },
      { address: "Bergweg 49-D", price: 450000, size: 135, rooms: 3, label: "B", status: "Verkocht" },
      { address: "Bergweg 104-H", price: 360000, size: 50, rooms: 1, label: "A+++", status: "Verkocht" },
      { address: "Bergweg 123-A", price: 650000, size: 146, rooms: 4, label: "B", status: "Verkocht" },
      { address: "Bergweg 262-A", price: 450000, size: 133, rooms: 6, label: "A", status: "Verkocht" },
      { address: "Bergweg 55-D", price: 419000, size: 108, rooms: 3, label: "D", status: "Verkocht" },
      { address: "Bergweg 252", price: 395000, size: 101, rooms: 3, label: "D", status: "Verkocht" },
      { address: "Bergweg 258-B", price: 300000, size: 95, rooms: 3, label: "F", status: "Verkocht" },
      { address: "Bergweg 167-B", price: 675000, size: 154, rooms: 3, label: "D", status: "Verkocht" },
      { address: "Bergweg 114-F", price: 535000, size: 75, rooms: 2, label: "A+++", status: "Verkocht" },
      { address: "Bergweg 104-J", price: 350000, size: 50, rooms: 1, label: "A+++", status: "Verkocht" },
      { address: "Bergweg 61-A", price: 409000, size: 107, rooms: 2, label: "C", status: "Verkocht" },
      { address: "Bergweg 104-T", price: 270000, size: 50, rooms: 1, label: "A++", status: "Verkocht" },
      { address: "Bergweg 112-F", price: 500000, size: 75, rooms: 2, label: "A+++", status: "Verkocht" },
      { address: "Bergweg 310", price: 750000, size: 247, rooms: 6, label: "D", status: "Verkocht" },
      { address: "Bergweg 88-F", price: 325000, size: 75, rooms: 2, label: "A", status: "Onder voorbehoud" },
      { address: "Bergweg 98-B", price: 625000, size: 114, rooms: 4, label: "A", status: "Onder voorbehoud" },
      { address: "Bergweg 307-A", price: 450000, size: 79, rooms: 2, label: "A", status: "Onder bod" },
      { address: "Bergweg 330-C", price: 425000, size: 140, rooms: 3, label: "D", status: "Verkocht" },
      { address: "Bergweg 108-J", price: 340000, size: 50, rooms: 1, label: "A+++", status: "Verkocht" },
      { address: "Bergweg 106-A", price: 495000, size: 71, rooms: 2, label: "A+++", status: "Verkocht" },
      { address: "Bergweg 106-B", price: 450000, size: 68, rooms: 2, label: "A+++", status: "Verkocht" },
      { address: "Bergweg 255-A", price: 550000, size: 117, rooms: 2, label: "B", status: "Verkocht" },
      { address: "Bergweg 236-B", price: 395000, size: 137, rooms: 6, label: "F", status: "Verkocht" },
      { address: "Bergweg 205-A01 (huis)", price: 795000, size: 265, rooms: 4, label: "?", status: "Beschikbaar" },
      { address: "Bergweg 205-A02", price: 392750, size: 69, rooms: 2, label: "A+++", status: "Beschikbaar" },
      { address: "Bergweg 205-A01 (app)", price: 352500, size: 61, rooms: 2, label: "A+++", status: "Beschikbaar" },
      { address: "Bergweg 205-B", price: 699500, size: 128, rooms: 3, label: "A+++", status: "Beschikbaar" },
      { address: "Bergweg 72", price: 672000, size: 96, rooms: 3, label: "A+++", status: "Onder voorbehoud" },
      { address: "Bergweg 53-A", price: 500000, size: 108, rooms: 3, label: "C", status: "Onder voorbehoud" },
      { address: "Bergweg 311-A", price: 329000, size: 67, rooms: 2, label: "B", status: "Onder voorbehoud" },
      { address: "Bergweg 65-A", price: 475000, size: 110, rooms: 3, label: "E", status: "Onder voorbehoud" },
      { address: "Bergweg 116-B", price: 450000, size: 77, rooms: 1, label: "A++", status: "Onder voorbehoud" },
      { address: "Bergweg 253-B", price: 625000, size: 111, rooms: 3, label: "A", status: "Onder bod" },
      { address: "Bergweg 309-B", price: 499500, size: 112, rooms: 3, label: "A", status: "Verkocht" },
      { address: "Bergweg 148-A", price: 350000, size: 66, rooms: 1, label: "A", status: "Verkocht" },
      { address: "Bergweg 153-B", price: 325000, size: 55, rooms: 2, label: "A", status: "Verkocht" },
      { address: "Bergweg 240-A", price: 499500, size: 91, rooms: 2, label: "D", status: "Verkocht" },
      { address: "Bergweg 39-D", price: 385000, size: 115, rooms: 5, label: "D", status: "Verkocht" },
      { address: "Bergweg 155-D", price: 345000, size: 65, rooms: 1, label: "A", status: "Verkocht" },
      { address: "Bergweg 282-C", price: 350000, size: 80, rooms: 2, label: "C", status: "Verkocht" },
      { address: "Bergweg 106-C", price: 360000, size: 50, rooms: 1, label: "A++", status: "Verkocht" },
      { address: "Bergweg 129-a", price: 495000, size: 144, rooms: 3, label: "C", status: "Verkocht" },
      { address: "Bergweg 47-C", price: 280000, size: 61, rooms: 2, label: "E", status: "Verkocht" },
      { address: "Bergweg 236-A", price: 499500, size: 117, rooms: 4, label: "A", status: "Verkocht" },
      { address: "Bergweg 102-B", price: 425000, size: 107, rooms: 3, label: "C", status: "Verkocht" },
      { address: "Bergweg 162-A", price: 600000, size: 142, rooms: 2, label: "A", status: "Verkocht" },
      { address: "Bergweg 55-C", price: 315000, size: 59, rooms: 2, label: "B", status: "Verkocht" }
    ];
    
    /* ---------------------------------------------
       2. Preprocessing
    --------------------------------------------- */
    const propsWithM2 = properties
      .filter(p => p.size > 0)
      .map(p => ({ ...p, pricePerM2: Math.round(p.price / p.size) }));
    
    const avg = arr => Math.round(arr.reduce((s, v) => s + v, 0) / arr.length);
    
    const avgM2 = avg(propsWithM2.map(p => p.pricePerM2));
    const avgPrice = avg(propsWithM2.map(p => p.price));
    const avgSize = avg(propsWithM2.map(p => p.size));
    
    const maxM2 = Math.max(...propsWithM2.map(p => p.pricePerM2));
    const minM2 = Math.min(...propsWithM2.map(p => p.pricePerM2));
    
    const soldCount = properties.filter(p => p.status === "Verkocht").length;
    const soldPct = Math.round((soldCount / properties.length) * 100);
    
    const AplusCount = properties.filter(p => p.label.startsWith("A")).length;
    const AplusPct = Math.round((AplusCount / properties.length) * 100);
    
    const m2Ranges = [
      { range: "‚Ç¨3.000‚Äì‚Ç¨4.000", min: 3000, max: 4000, count: 0 },
      { range: "‚Ç¨4.000‚Äì‚Ç¨5.000", min: 4000, max: 5000, count: 0 },
      { range: "‚Ç¨5.000‚Äì‚Ç¨6.000", min: 5000, max: 6000, count: 0 },
      { range: "‚Ç¨6.000‚Äì‚Ç¨7.000", min: 6000, max: 7000, count: 0 },
      { range: "‚Ç¨7.000+", min: 7000, max: 20000, count: 0 }
    ];
    
    propsWithM2.forEach(p => {
      const r = m2Ranges.find(x => p.pricePerM2 >= x.min && p.pricePerM2 < x.max);
      if (r) r.count++;
    });
    
    /* ---------------------------------------------
       3. KPI's
    --------------------------------------------- */
    document.getElementById("kpis").innerHTML = `
      <div class="bg-white p-6 shadow rounded">
        <p class="text-sm text-gray-600">Gemiddelde prijs/m¬≤</p>
        <p class="text-2xl font-bold text-blue-600">‚Ç¨${avgM2.toLocaleString()}</p>
      </div>
      <div class="bg-white p-6 shadow rounded">
        <p class="text-sm text-gray-600">Gemiddelde prijs</p>
        <p class="text-2xl font-bold text-green-600">‚Ç¨${avgPrice.toLocaleString()}</p>
      </div>
      <div class="bg-white p-6 shadow rounded">
        <p class="text-sm text-gray-600">Gem. oppervlakte</p>
        <p class="text-2xl font-bold text-purple-600">${avgSize} m¬≤</p>
      </div>
    `;
    
    /* ---------------------------------------------
       4. Insights
    --------------------------------------------- */
    const addInsight = txt => {
      const ul = document.getElementById("insights");
      const li = document.createElement("li");
      li.innerHTML = `<span class='text-blue-500 mr-2'>‚Ä¢</span>${txt}`;
      ul.appendChild(li);
    };
    
    addInsight(`Gemiddelde prijs per m¬≤: ‚Ç¨${avgM2.toLocaleString()}.`);
    addInsight(`${soldPct}% van alle woningen is verkocht.`);
    addInsight(`Laagste m¬≤-prijs: ‚Ç¨${minM2.toLocaleString()}. Hoogste: ‚Ç¨${maxM2.toLocaleString()}.`);
    addInsight(`${AplusPct}% van de woningen heeft energielabel A of hoger.`);
    
    /* ---------------------------------------------
       5. Details tabel
    --------------------------------------------- */
    const table = document.getElementById("table-body");
    
    propsWithM2
      .sort((a, b) => b.pricePerM2 - a.pricePerM2)
      .forEach(p => {
        table.innerHTML += `
          <tr class="border-b">
            <td class="px-4 py-2">${p.address}</td>
            <td class="px-4 py-2">‚Ç¨${p.price.toLocaleString()}</td>
            <td class="px-4 py-2">${p.size}</td>
            <td class="px-4 py-2 text-blue-600 font-bold">‚Ç¨${p.pricePerM2}</td>
            <td class="px-4 py-2">${p.status}</td>
          </tr>`;
      });
    
    /* ---------------------------------------------
       6. Charts
    --------------------------------------------- */
    // ‚Äî Bar Chart ‚Äî
    new Chart(
      document.getElementById("chart-m2ranges"),
      {
        type: "bar",
        data: {
          labels: m2Ranges.map(r => r.range),
          datasets: [{
            label: "Aantal woningen",
            data: m2Ranges.map(r => r.count),
            backgroundColor: "#3b82f6"
          }]
        }
      }
    );
    
    // ‚Äî Scatter Chart ‚Äî
    let scatterChart;
    
    function buildScatter(highlight = null) {
      if (scatterChart) scatterChart.destroy();
    
      scatterChart = new Chart(
        document.getElementById("chart-scatter"),
        {
          type: "scatter",
          data: {
            datasets: [
              {
                label: "Overige woningen",
                data: propsWithM2.map(p => ({ x: p.size, y: p.price })),
                pointRadius: 5,
                backgroundColor: "#8884d8"
              },
              highlight ? {
                label: "Jouw woning",
                data: [highlight],
                pointRadius: 10,
                backgroundColor: "red"
              } : null
            ].filter(Boolean)
          }
        }
      );
    }
    
    buildScatter();
    
    /* ---------------------------------------------
       7. Tabs
    --------------------------------------------- */
    document.querySelectorAll(".tab-btn").forEach(btn => {
      btn.onclick = () => {
        const tab = btn.dataset.tab;
    
        document.querySelectorAll(".tab-btn").forEach(b => {
          b.classList.remove("border-blue-600", "border-b-2", "text-blue-600");
          b.classList.add("text-gray-600");
        });
    
        btn.classList.add("border-b-2", "border-blue-600", "text-blue-600");
    
        document.querySelectorAll("[id^='tab-']").forEach(div => div.classList.add("hidden"));
        document.getElementById("tab-" + tab).classList.remove("hidden");
      };
    });
    
    /* ---------------------------------------------
       8. Woning invoeren + highlight + waardering
    --------------------------------------------- */
    document.getElementById("btn-calc").onclick = () => {
      const s = Number(document.getElementById("input-size").value);
      const r = Number(document.getElementById("input-rooms").value);
      const l = document.getElementById("input-label").value;
    
      if (!s) {
        alert("Voer minimaal woonoppervlakte in!");
        return;
      }
    
      const userM2 = Math.round(avgM2 * (l.startsWith("A") ? 1.03 : 0.97));
      const estPrice = Math.round(s * userM2);
    
      buildScatter({ x: s, y: estPrice });
    
      document.getElementById("user-output").innerHTML = `
        <p><strong>Geschatte waarde per m¬≤:</strong> ‚Ç¨${userM2.toLocaleString()}</p>
        <p><strong>Geschatte waarde woning:</strong> ‚Ç¨${estPrice.toLocaleString()}</p>
      `;
    
      document.getElementById("ai-valuation").innerHTML = `
        Op basis van alle woningen op de Bergweg, jouw ingevoerde kenmerken (m¬≤, kamers, energielabel) 
        en marktgemiddelden, verwachten wij een re√´le vraagprijs tussen
        <strong>‚Ç¨${(estPrice * 0.93).toLocaleString()}</strong> en 
        <strong>‚Ç¨${(estPrice * 1.05).toLocaleString()}</strong>.
      `;
    };
    </script>
    
    </body>
    </html>
    